<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HK AI</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#06070f;--s1:#0a0c1a;--s2:#0e1122;--s3:#131526;
  --border:rgba(120,140,255,0.1);--border2:rgba(120,140,255,0.06);
  --a1:#6c8eff;--a2:#a78bfa;--a3:#34d399;--a4:#f472b6;
  --text:#dde3ff;--muted:#5a6285;--muted2:#343850;
  --glow:rgba(108,142,255,0.12);
}
html,body{width:100%;height:100%;background:var(--bg);font-family:'Outfit',sans-serif;color:var(--text);overflow:hidden}

/* BG GRID */
body::after{content:"";position:fixed;inset:0;background-image:linear-gradient(rgba(108,142,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(108,142,255,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}

/* ORBS */
.orbs{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
.orb{position:absolute;border-radius:50%;filter:blur(100px);animation:orbDrift 20s ease-in-out infinite alternate}
.orb:nth-child(1){width:700px;height:700px;background:radial-gradient(circle,rgba(108,142,255,0.08),transparent 60%);top:-300px;right:-200px;animation-duration:18s}
.orb:nth-child(2){width:500px;height:500px;background:radial-gradient(circle,rgba(167,139,250,0.07),transparent 60%);bottom:-200px;left:-100px;animation-duration:24s;animation-delay:-8s}
.orb:nth-child(3){width:300px;height:300px;background:radial-gradient(circle,rgba(52,211,153,0.06),transparent 60%);top:40%;left:40%;animation-duration:16s;animation-delay:-5s}
@keyframes orbDrift{0%{transform:translate(0,0)}100%{transform:translate(30px,50px)}}

/* LAYOUT */
.app{display:flex;height:100vh;position:relative;z-index:1}

/* SIDEBAR */
.sidebar{width:260px;background:rgba(10,12,26,0.85);border-right:1px solid var(--border);display:flex;flex-direction:column;backdrop-filter:blur(24px);flex-shrink:0;transition:width .3s cubic-bezier(.4,0,.2,1);overflow:hidden}
.sidebar.collapsed{width:64px}
.sb-top{padding:18px 16px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;overflow:hidden}
.logo-icon{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,var(--a1),var(--a2));display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:800;color:#fff;flex-shrink:0;letter-spacing:-0.5px}
.logo-name{font-size:17px;font-weight:800;background:linear-gradient(90deg,var(--a1),var(--a2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;white-space:nowrap;transition:opacity .2s}
.sidebar.collapsed .logo-name{opacity:0;width:0}
.sb-toggle{width:28px;height:28px;border-radius:7px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;transition:all .2s}
.sb-toggle:hover{background:var(--glow);color:var(--a1)}

.new-btn{margin:12px;padding:10px;background:linear-gradient(135deg,var(--a1),var(--a2));border:none;border-radius:10px;color:#fff;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:opacity .2s;white-space:nowrap;overflow:hidden}
.new-btn:hover{opacity:.85}
.new-btn span{transition:opacity .2s}
.sidebar.collapsed .new-btn span{opacity:0;width:0}

.sb-section{padding:4px 8px;margin-top:2px}
.sb-label{font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted2);padding:8px 8px 4px;white-space:nowrap;overflow:hidden;transition:opacity .2s}
.sidebar.collapsed .sb-label{opacity:0}
.sb-item{display:flex;align-items:center;gap:9px;padding:9px 10px;border-radius:9px;cursor:pointer;font-size:13px;font-weight:500;color:var(--muted);transition:all .15s;white-space:nowrap;overflow:hidden;border:1px solid transparent}
.sb-item:hover{background:rgba(255,255,255,0.04);color:var(--text)}
.sb-item.active{background:rgba(108,142,255,0.1);color:var(--a1);border-color:rgba(108,142,255,0.15)}
.sb-item .ic{font-size:15px;flex-shrink:0;width:18px;text-align:center}
.sb-item-label{transition:opacity .2s;white-space:nowrap}
.sidebar.collapsed .sb-item-label{opacity:0;width:0}

.sb-chat-list{flex:1;overflow-y:auto;padding:4px 8px}
.sb-chat-list::-webkit-scrollbar{width:2px}
.sb-chat-list::-webkit-scrollbar-thumb{background:var(--border)}
.chat-item{padding:9px 10px;border-radius:9px;cursor:pointer;transition:all .15s;margin-bottom:1px;overflow:hidden}
.chat-item:hover{background:rgba(255,255,255,0.04)}
.chat-item.active{background:rgba(108,142,255,0.08);border:1px solid rgba(108,142,255,0.12)}
.ci-title{font-size:12px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px}
.ci-time{font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace}
.sidebar.collapsed .chat-item{opacity:0;pointer-events:none}

.sb-bottom{padding:10px 8px;border-top:1px solid var(--border);margin-top:auto}
.user-row{display:flex;align-items:center;gap:9px;padding:8px 10px;border-radius:9px;cursor:pointer;transition:background .15s;overflow:hidden}
.user-row:hover{background:rgba(255,255,255,0.04)}
.user-av{width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,var(--a2),var(--a4));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0}
.user-details{transition:opacity .2s;white-space:nowrap}
.sidebar.collapsed .user-details{opacity:0;width:0}
.user-name{font-size:12px;font-weight:600}
.user-plan{font-size:10px;color:var(--a3);font-family:'DM Mono',monospace}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column;min-width:0;overflow:hidden}

/* TOPBAR */
.topbar{height:52px;border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 20px;gap:12px;background:rgba(6,7,15,0.7);backdrop-filter:blur(20px);flex-shrink:0}
.model-selector{display:flex;align-items:center;gap:8px;background:var(--s2);border:1px solid var(--border);border-radius:9px;padding:6px 12px;font-size:12px;cursor:pointer;transition:border-color .2s;position:relative}
.model-selector:hover{border-color:rgba(108,142,255,0.25)}
.model-dot{width:7px;height:7px;border-radius:50%;background:var(--a3);box-shadow:0 0 6px var(--a3);animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}
.model-name{font-weight:600;color:var(--text);font-size:12px}
.model-arrow{color:var(--muted);font-size:10px;margin-left:2px}
.source-pills{display:flex;gap:6px;flex:1}
.source-pill{display:flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600;border:1px solid;cursor:pointer;transition:all .2s;white-space:nowrap}
.source-pill.web{background:rgba(52,211,153,0.08);border-color:rgba(52,211,153,0.2);color:var(--a3)}
.source-pill.web.off{background:transparent;border-color:var(--border2);color:var(--muted)}
.source-pill.claude{background:rgba(108,142,255,0.08);border-color:rgba(108,142,255,0.2);color:var(--a1)}
.source-pill.claude.off{background:transparent;border-color:var(--border2);color:var(--muted)}
.source-pill.deep{background:rgba(244,114,182,0.08);border-color:rgba(244,114,182,0.2);color:var(--a4)}
.source-pill.deep.off{background:transparent;border-color:var(--border2);color:var(--muted)}
.source-pill:hover{opacity:.85}
.tb-right{display:flex;gap:8px;align-items:center;margin-left:auto}
.tb-btn{width:32px;height:32px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all .2s}
.tb-btn:hover{background:var(--glow);color:var(--a1);border-color:rgba(108,142,255,0.3)}

/* CHAT AREA */
.chat-wrap{flex:1;overflow-y:auto;padding:32px 0;scroll-behavior:smooth}
.chat-wrap::-webkit-scrollbar{width:4px}
.chat-wrap::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.chat-inner{max-width:760px;margin:0 auto;padding:0 24px;display:flex;flex-direction:column;gap:24px}

/* WELCOME */
.welcome{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;text-align:center;gap:20px}
.welcome-icon{width:72px;height:72px;border-radius:20px;background:linear-gradient(135deg,var(--a1),var(--a2));display:flex;align-items:center;justify-content:center;font-size:30px;box-shadow:0 0 50px rgba(108,142,255,0.3),0 0 100px rgba(108,142,255,0.1);animation:iconPulse 3s ease-in-out infinite alternate}
@keyframes iconPulse{0%{box-shadow:0 0 30px rgba(108,142,255,0.2)}100%{box-shadow:0 0 70px rgba(108,142,255,0.45)}}
.welcome h1{font-size:32px;font-weight:800;letter-spacing:-1px;line-height:1.1;background:linear-gradient(135deg,#fff 0%,var(--a1) 50%,var(--a2) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.welcome p{font-size:14px;color:var(--muted);max-width:440px;line-height:1.7}
.source-badges{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.src-badge{display:flex;align-items:center;gap:6px;padding:6px 12px;background:var(--s2);border:1px solid var(--border);border-radius:20px;font-size:11px;font-weight:600;color:var(--muted)}
.src-badge .dot{width:6px;height:6px;border-radius:50%}
.suggest-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;width:100%;max-width:520px}
.suggest-card{background:var(--s2);border:1px solid var(--border);border-radius:12px;padding:14px 16px;cursor:pointer;transition:all .2s;text-align:left}
.suggest-card:hover{background:var(--s3);border-color:rgba(108,142,255,0.25);transform:translateY(-2px)}
.sc-icon{font-size:18px;margin-bottom:6px}
.sc-text{font-size:12px;font-weight:500;line-height:1.5;color:var(--text)}

/* MESSAGES */
.msg{display:flex;gap:12px;animation:msgSlide .3s ease}
@keyframes msgSlide{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.msg.user{flex-direction:row-reverse}
.msg-av{width:32px;height:32px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;margin-top:2px}
.msg-av.ai{background:linear-gradient(135deg,var(--a1),var(--a2));box-shadow:0 0 12px rgba(108,142,255,0.25)}
.msg-av.user{background:linear-gradient(135deg,var(--a2),var(--a4))}
.msg-content{flex:1;min-width:0;display:flex;flex-direction:column;gap:6px}
.msg.user .msg-content{align-items:flex-end}
.msg-bubble{padding:13px 16px;border-radius:14px;font-size:13.5px;line-height:1.7;max-width:85%}
.msg-bubble.ai{background:var(--s2);border:1px solid var(--border);border-radius:14px 14px 14px 4px}
.msg-bubble.user{background:linear-gradient(135deg,var(--a1),var(--a2));color:#fff;border-radius:14px 14px 4px 14px;max-width:75%}
.msg-bubble.ai pre{background:rgba(0,0,0,0.3);border:1px solid var(--border2);border-radius:8px;padding:12px;margin:8px 0;overflow-x:auto;font-family:'DM Mono',monospace;font-size:12px;line-height:1.6}
.msg-bubble.ai code{font-family:'DM Mono',monospace;font-size:12px;background:rgba(108,142,255,0.1);padding:1px 5px;border-radius:4px}
.msg-bubble.ai strong{color:#fff;font-weight:600}
.msg-bubble.ai ul,
.msg-bubble.ai ol{padding-left:18px;margin:6px 0}
.msg-bubble.ai li{margin-bottom:4px}

/* SOURCE TAGS */
.source-tags{display:flex;gap:6px;flex-wrap:wrap}
.src-tag{display:flex;align-items:center;gap:4px;padding:3px 8px;border-radius:12px;font-size:10px;font-weight:600;font-family:'DM Mono',monospace}
.src-tag.web{background:rgba(52,211,153,0.1);color:var(--a3);border:1px solid rgba(52,211,153,0.15)}
.src-tag.claude{background:rgba(108,142,255,0.1);color:var(--a1);border:1px solid rgba(108,142,255,0.15)}
.src-tag.deep{background:rgba(244,114,182,0.1);color:var(--a4);border:1px solid rgba(244,114,182,0.15)}

.msg-actions{display:flex;gap:6px;opacity:0;transition:opacity .2s}
.msg:hover .msg-actions{opacity:1}
.act-btn{padding:3px 9px;background:var(--s2);border:1px solid var(--border);border-radius:6px;font-size:10px;color:var(--muted);cursor:pointer;font-family:'Outfit',sans-serif;transition:all .15s}
.act-btn:hover{color:var(--a1);border-color:rgba(108,142,255,0.3)}

/* TYPING */
.typing-bubble{display:flex;align-items:center;gap:12px;padding:13px 16px;background:var(--s2);border:1px solid var(--border);border-radius:14px 14px 14px 4px;width:fit-content}
.typing-dots{display:flex;gap:5px}
.typing-dots span{width:6px;height:6px;border-radius:50%;background:var(--a1);animation:td .9s infinite}
.typing-dots span:nth-child(2){animation-delay:.15s}
.typing-dots span:nth-child(3){animation-delay:.3s}
@keyframes td{0%,60%,100%{opacity:.2;transform:translateY(0)}30%{opacity:1;transform:translateY(-3px)}}
.typing-label{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace}

/* SEARCH INDICATOR */
.search-indicator{display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(52,211,153,0.06);border:1px solid rgba(52,211,153,0.12);border-radius:10px;font-size:11px;color:var(--a3);width:fit-content;margin-bottom:4px}
.search-spin{width:12px;height:12px;border:2px solid rgba(52,211,153,0.2);border-top-color:var(--a3);border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}

/* INPUT */
.input-area{padding:16px 24px 20px;border-top:1px solid var(--border);background:rgba(6,7,15,0.8);backdrop-filter:blur(20px);flex-shrink:0}
.input-wrap{max-width:760px;margin:0 auto}
.input-box{background:var(--s2);border:1px solid var(--border);border-radius:14px;transition:border-color .25s,box-shadow .25s;overflow:hidden}
.input-box:focus-within{border-color:rgba(108,142,255,0.4);box-shadow:0 0 0 3px rgba(108,142,255,0.07)}
.input-row{display:flex;align-items:flex-end;padding:10px 14px;gap:10px}
.input-row textarea{flex:1;background:none;border:none;outline:none;color:var(--text);font-family:'Outfit',sans-serif;font-size:13.5px;resize:none;line-height:1.6;max-height:140px}
.input-row textarea::placeholder{color:var(--muted)}
.send-btn{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--a1),var(--a2));border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;transition:all .2s;box-shadow:0 4px 12px rgba(108,142,255,0.3)}
.send-btn:hover{transform:scale(1.05);box-shadow:0 6px 20px rgba(108,142,255,0.4)}
.send-btn:disabled{opacity:.35;cursor:not-allowed;transform:none}
.input-footer{display:flex;align-items:center;gap:8px;padding:8px 14px 10px;border-top:1px solid var(--border2)}
.input-tool{width:26px;height:26px;border-radius:7px;border:1px solid var(--border2);background:transparent;color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all .2s}
.input-tool:hover{background:var(--glow);color:var(--a1);border-color:rgba(108,142,255,0.3)}
.input-hint{font-size:11px;color:var(--muted2);margin-left:auto;font-family:'DM Mono',monospace}

/* SUGGESTIONS */
.quick-suggestions{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
.qs-chip{padding:6px 12px;background:var(--s2);border:1px solid var(--border);border-radius:20px;font-size:11px;color:var(--muted);cursor:pointer;transition:all .2s;white-space:nowrap}
.qs-chip:hover{background:var(--glow);color:var(--a1);border-color:rgba(108,142,255,0.25)}

/* MODEL DROPDOWN */
.model-dropdown{position:absolute;top:42px;left:0;background:var(--s2);border:1px solid var(--border);border-radius:12px;padding:6px;z-index:100;min-width:200px;box-shadow:0 12px 40px rgba(0,0,0,0.5);display:none}
.model-dropdown.open{display:block}
.model-opt{padding:9px 12px;border-radius:8px;cursor:pointer;font-size:12px;font-weight:500;transition:background .15s;display:flex;align-items:center;gap:8px}
.model-opt:hover{background:rgba(255,255,255,0.05)}
.model-opt.active{color:var(--a1)}
.model-opt-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;z-index:999;background:var(--s2);border:1px solid var(--border);border-radius:12px;padding:11px 18px;font-size:12px;font-weight:600;display:none;align-items:center;gap:8px;backdrop-filter:blur(20px);box-shadow:0 8px 32px rgba(0,0,0,0.4);animation:toastIn .3s ease}
.toast.show{display:flex}
@keyframes toastIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* ===== TRIAL BANNER ===== */
.trial-banner{position:fixed;top:0;left:0;right:0;z-index:9999;background:linear-gradient(90deg,#6c8eff,#a78bfa,#34d399);padding:0;height:0;overflow:hidden;transition:height .3s;display:flex;align-items:center;justify-content:center;gap:16px;font-size:12px;font-weight:600;color:#fff}
.trial-banner.show{height:36px}
.trial-banner .countdown{font-family:'DM Mono',monospace;background:rgba(0,0,0,0.2);padding:3px 10px;border-radius:20px}
.trial-banner .upgrade-link{background:rgba(255,255,255,0.25);padding:4px 12px;border-radius:20px;cursor:pointer;transition:background .2s}
.trial-banner .upgrade-link:hover{background:rgba(255,255,255,0.4)}

/* ===== UPLOAD COUNTER (top right) ===== */
.upload-counter{display:flex;align-items:center;gap:6px;background:var(--s2);border:1px solid var(--border);border-radius:9px;padding:5px 10px;font-size:11px;font-weight:600;font-family:'DM Mono',monospace;cursor:pointer;transition:all .2s}
.upload-counter:hover{border-color:rgba(108,142,255,0.3)}
.upload-counter .uc-bar{width:40px;height:4px;background:var(--muted2);border-radius:2px;overflow:hidden}
.upload-counter .uc-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--a3),var(--a1));transition:width .3s}
.upload-counter.warning .uc-fill{background:linear-gradient(90deg,#f59e0b,#ef4444)}
.upload-counter.danger{border-color:rgba(239,68,68,0.4);color:var(--error)}
.upload-counter.danger .uc-fill{background:var(--error)}

/* ===== UPGRADE MODAL ===== */
.upgrade-overlay{position:fixed;inset:0;z-index:9000;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center}
.upgrade-overlay.show{display:flex}
.upgrade-modal{background:var(--s1);border:1px solid rgba(108,142,255,0.2);border-radius:20px;padding:36px;max-width:520px;width:90%;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,0.6);animation:modalIn .3s ease}
@keyframes modalIn{from{opacity:0;transform:scale(0.95) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.upgrade-modal .um-icon{font-size:48px;margin-bottom:12px}
.upgrade-modal h2{font-family:'Outfit',sans-serif;font-size:24px;font-weight:800;margin-bottom:8px;background:linear-gradient(135deg,#fff,var(--a1));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.upgrade-modal p{font-size:13px;color:var(--muted);line-height:1.7;margin-bottom:24px}
.plans-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px}
.plan-card{background:var(--s2);border:1px solid var(--border);border-radius:14px;padding:18px;text-align:left;cursor:pointer;transition:all .2s;position:relative}
.plan-card:hover{border-color:rgba(108,142,255,0.4);transform:translateY(-2px)}
.plan-card.popular{border-color:rgba(108,142,255,0.5);background:rgba(108,142,255,0.06)}
.plan-badge{position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--a1),var(--a2));color:#fff;font-size:10px;font-weight:700;padding:3px 12px;border-radius:20px;white-space:nowrap}
.plan-name{font-size:14px;font-weight:700;margin-bottom:4px}
.plan-price{font-family:'DM Mono',monospace;font-size:22px;font-weight:700;color:var(--a1);margin-bottom:8px}
.plan-price span{font-size:12px;color:var(--muted);font-family:'Outfit',sans-serif}
.plan-features{font-size:11px;color:var(--muted);line-height:1.8}
.plan-features li{list-style:none;padding-left:16px;position:relative}
.plan-features li::before{content:"‚úì";position:absolute;left:0;color:var(--a3);font-weight:700}
.upgrade-close{margin-top:8px;background:none;border:none;color:var(--muted);font-size:12px;cursor:pointer;font-family:'Outfit',sans-serif}
.upgrade-close:hover{color:var(--text)}

/* ===== PHOTO PAGE ===== */
.photo-layout{padding:24px;overflow-y:auto;height:100%;display:flex;flex-direction:column;gap:16px}
.photo-layout::-webkit-scrollbar{width:4px}
.photo-layout::-webkit-scrollbar-thumb{background:var(--border)}
.photo-tabs{display:flex;gap:8px;margin-bottom:4px}
.ptab{padding:8px 18px;border-radius:9px;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Outfit',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.ptab.active{background:rgba(108,142,255,0.12);color:var(--a1);border-color:rgba(108,142,255,0.3)}
.photo-gen-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.pcard{background:var(--s2);border:1px solid var(--border);border-radius:14px;padding:20px}
.pcard-title{font-size:13px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.pcard .tf-group{margin-bottom:12px}
.pcard .tf-label{font-size:10px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--muted);margin-bottom:6px;display:block}
.pcard .tf-input,.pcard .tf-select,.pcard .tf-textarea{width:100%;background:var(--s3);border:1px solid var(--border);border-radius:9px;padding:9px 12px;font-family:'Outfit',sans-serif;font-size:12px;color:var(--text);outline:none;transition:border-color .2s}
.pcard .tf-input:focus,.pcard .tf-select:focus,.pcard .tf-textarea:focus{border-color:rgba(108,142,255,0.4)}
.pcard .tf-textarea{height:90px;resize:vertical;padding-top:9px}
.pcard .tf-select option{background:var(--s2)}
.pcard .tf-input::placeholder,.pcard .tf-textarea::placeholder{color:var(--muted2)}
.photo-preview{background:var(--s3);border:1px solid var(--border);border-radius:10px;aspect-ratio:1;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:10px;margin-bottom:12px;position:relative;overflow:hidden;max-height:280px}
.photo-preview img{width:100%;height:100%;object-fit:cover;border-radius:10px}
.photo-preview.generating::after{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(108,142,255,0.1),rgba(167,139,250,0.1),rgba(52,211,153,0.1));animation:photoShimmer 2s infinite}
@keyframes photoShimmer{0%,100%{opacity:0.3}50%{opacity:1}}
.photo-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.photo-item{aspect-ratio:1;background:var(--s3);border:1px solid var(--border);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.photo-item:hover{border-color:rgba(108,142,255,0.3);transform:scale(1.03)}
.photo-item-label{position:absolute;bottom:0;left:0;right:0;padding:5px;background:rgba(0,0,0,0.65);font-size:9px;color:var(--muted);text-align:center}
.style-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px}
.style-opt{padding:10px 6px;background:var(--s3);border:1px solid var(--border);border-radius:9px;text-align:center;cursor:pointer;transition:all .2s;font-size:11px;color:var(--muted)}
.style-opt:hover,.style-opt.active{background:rgba(108,142,255,0.1);border-color:rgba(108,142,255,0.3);color:var(--a1)}
.style-opt .so-icon{font-size:18px;display:block;margin-bottom:4px}
.aspect-btns{display:flex;gap:6px;margin-bottom:14px}
.aspect-btn{padding:6px 12px;background:var(--s3);border:1px solid var(--border);border-radius:7px;color:var(--muted);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Outfit',sans-serif}
.aspect-btn.active{background:rgba(108,142,255,0.12);border-color:rgba(108,142,255,0.3);color:var(--a1)}
.edit-canvas{background:var(--s3);border:1px solid var(--border);border-radius:10px;aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:8px;position:relative;overflow:hidden;margin-bottom:12px;cursor:pointer}
.edit-canvas.has-image{cursor:default}
.photo-edit-tools{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:14px}
.pet-btn{padding:10px 6px;background:var(--s3);border:1px solid var(--border);border-radius:9px;text-align:center;cursor:pointer;transition:all .2s}
.pet-btn:hover{background:rgba(108,142,255,0.1);border-color:rgba(108,142,255,0.3);transform:translateY(-2px)}
.pet-icon{font-size:18px;display:block;margin-bottom:3px}
.pet-label{font-size:9px;color:var(--muted)}
.slider-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.slider-label{font-size:11px;color:var(--muted);width:80px;flex-shrink:0}
.slider-input{flex:1;accent-color:var(--a1)}
.slider-val{font-size:11px;color:var(--a1);width:30px;text-align:right;font-family:'DM Mono',monospace}

/* ===== VIDEO PAGE ===== */
/* ===== VIDEO PAGE ===== */
.video-layout{padding:24px;overflow-y:auto;height:100%;display:flex;flex-direction:column;gap:16px}
.video-layout::-webkit-scrollbar{width:4px}
.video-layout::-webkit-scrollbar-thumb{background:var(--border)}
.video-tabs{display:flex;gap:8px;margin-bottom:4px}
.vtab{padding:8px 18px;border-radius:9px;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Outfit',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.vtab.active{background:rgba(108,142,255,0.12);color:var(--a1);border-color:rgba(108,142,255,0.3)}
.video-gen-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.vcard{background:var(--s2);border:1px solid var(--border);border-radius:14px;padding:20px}
.vcard-title{font-size:13px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.vcard .tf-group{margin-bottom:12px}
.vcard .tf-label{font-size:10px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--muted);margin-bottom:6px;display:block}
.vcard .tf-input,.vcard .tf-select,.vcard .tf-textarea{width:100%;background:var(--s3);border:1px solid var(--border);border-radius:9px;padding:9px 12px;font-family:'Outfit',sans-serif;font-size:12px;color:var(--text);outline:none;transition:border-color .2s}
.vcard .tf-input:focus,.vcard .tf-select:focus,.vcard .tf-textarea:focus{border-color:rgba(108,142,255,0.4)}
.vcard .tf-textarea{height:90px;resize:vertical;padding-top:9px}
.vcard .tf-select option{background:var(--s2)}
.vcard .tf-input::placeholder,.vcard .tf-textarea::placeholder{color:var(--muted2)}
.gen-btn{width:100%;padding:11px;background:linear-gradient(135deg,var(--a1),var(--a2));border:none;border-radius:10px;color:#fff;font-family:'Outfit',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:opacity .2s;display:flex;align-items:center;justify-content:center;gap:8px}
.gen-btn:hover{opacity:.85}
.gen-btn:disabled{opacity:.4;cursor:not-allowed}
.video-preview{background:var(--s3);border:1px solid var(--border);border-radius:10px;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:10px;margin-bottom:12px;position:relative;overflow:hidden}
.video-preview.generating::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(108,142,255,0.1),transparent);animation:shimmer 1.5s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.vp-icon{font-size:32px}
.vp-text{font-size:12px;color:var(--muted)}
.vp-progress{width:80%;height:4px;background:var(--muted2);border-radius:2px;overflow:hidden;display:none}
.vp-progress.show{display:block}
.vp-progress-fill{height:100%;background:linear-gradient(90deg,var(--a1),var(--a2));border-radius:2px;transition:width .3s}
.video-samples{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.vsample{background:var(--s3);border:1px solid var(--border);border-radius:10px;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.vsample:hover{border-color:rgba(108,142,255,0.3);transform:scale(1.02)}
.vsample-label{position:absolute;bottom:0;left:0;right:0;padding:6px;background:rgba(0,0,0,0.6);font-size:10px;color:var(--muted);text-align:center}
.edit-tools{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:14px}
.edit-tool-btn{padding:10px;background:var(--s3);border:1px solid var(--border);border-radius:10px;cursor:pointer;font-size:20px;text-align:center;transition:all .2s}
.edit-tool-btn:hover{background:rgba(108,142,255,0.1);border-color:rgba(108,142,255,0.3);transform:translateY(-2px)}
.edit-tool-label{font-size:10px;color:var(--muted);margin-top:4px}
</style>
</style>
</head>
<body>
<div class="orbs"><div class="orb"></div><div class="orb"></div><div class="orb"></div></div>

<div class="app">
  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="sb-top">
      <div class="logo">
        <div class="logo-icon">HK</div>
        <div class="logo-name">HK AI</div>
      </div>
      <button class="sb-toggle" onclick="toggleSidebar()">‚óÄ</button>
    </div>

    <button class="new-btn" onclick="newChat()">‚ú¶ <span>New Chat</span></button>

    <div class="sb-section">
      <div class="sb-label">Recent Chats</div>
    </div>

    <div class="sb-chat-list" id="chat-list">
      <div class="chat-item active"><div class="ci-title">What is quantum computing?</div><div class="ci-time">just now</div></div>
      <div class="chat-item"><div class="ci-title">Best programming languages 2025</div><div class="ci-time">1h ago</div></div>
      <div class="chat-item"><div class="ci-title">How does the stock market work?</div><div class="ci-time">3h ago</div></div>
      <div class="chat-item"><div class="ci-title">Latest news in AI research</div><div class="ci-time">Yesterday</div></div>
      <div class="chat-item"><div class="ci-title">Explain black holes simply</div><div class="ci-time">2d ago</div></div>
      <div class="chat-item"><div class="ci-title">Write a Python web scraper</div><div class="ci-time">3d ago</div></div>
    </div>

    <div class="sb-bottom">
      <div class="user-row">
        <div class="user-av">H</div>
        <div class="user-details">
          <div class="user-name">Hesbordean</div>
          <div class="user-plan">PRO PLAN</div>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main">
    <!-- TOPBAR -->
    <div class="topbar">
      <div class="model-selector" onclick="toggleModelDropdown()" id="model-selector">
        <div class="model-dot"></div>
        <span class="model-name" id="model-name">HK AI Pro</span>
        <span class="model-arrow">‚ñæ</span>
        <div class="model-dropdown" id="model-dropdown">
          <div class="model-opt active" onclick="setModel('HK AI Pro',this)"><div class="model-opt-dot" style="background:var(--a3)"></div>HK AI Pro ‚Äî Most capable</div>
          <div class="model-opt" onclick="setModel('HK AI Fast',this)"><div class="model-opt-dot" style="background:var(--a1)"></div>HK AI Fast ‚Äî Quick answers</div>
          <div class="model-opt" onclick="setModel('HK AI Research',this)"><div class="model-opt-dot" style="background:var(--a4)"></div>HK AI Research ‚Äî Deep search</div>
        </div>
      </div>

      <div class="source-pills">
        <div class="source-pill web" id="pill-web" onclick="toggleSource('web')" title="Search the web for real-time info">üåê Web Search</div>
        <div class="source-pill claude" id="pill-claude" onclick="toggleSource('claude')" title="Use Claude AI reasoning">‚ú¶ Claude</div>
        <div class="source-pill deep" id="pill-deep" onclick="toggleSource('deep')" title="Deep research mode">üî¨ Deep Research</div>
      </div>

      <div class="tb-right">
      <img src="hk-ai-logo.svg" alt="HK AI Logo" style="height:36px;width:36px;border-radius:8px;object-fit:contain;cursor:pointer" onclick="showToast('Hesbordean KE','‚ú¶')">
        <div class="upload-counter" id="upload-counter" onclick="showUpgrade()" title="File uploads remaining">
        üìé <span id="upload-count">10</span>/10
        <div class="uc-bar"><div class="uc-fill" id="uc-fill" style="width:100%"></div></div>
      </div>
      <button class="tb-btn" title="Share" onclick="showToast('Link copied!','‚úÖ')">üîó</button>
        <button class="tb-btn" title="Settings" onclick="showToast('Settings coming soon','‚öôÔ∏è')">‚öôÔ∏è</button>
      </div>
    </div>

    <!-- CHAT -->
    <div class="chat-wrap" id="chat-wrap">
      <div class="chat-inner" id="chat-inner">
        <!-- WELCOME -->
        <div class="welcome" id="welcome-screen">
          <div class="welcome-icon">‚ú¶</div>
          <h1>Ask me anything.</h1>
          <p>HK AI searches the web, reasons with advanced AI, and synthesizes the best answer from multiple sources ‚Äî all in real time.</p>
          <div class="source-badges">
            <div class="src-badge"><div class="dot" style="background:var(--a3)"></div>Web Search</div>
            <div class="src-badge"><div class="dot" style="background:var(--a1)"></div>Claude AI</div>
            <div class="src-badge"><div class="dot" style="background:var(--a2)"></div>Deep Reasoning</div>
            <div class="src-badge"><div class="dot" style="background:var(--a4)"></div>Multi-source</div>
          </div>
          <div class="suggest-grid">
            <div class="suggest-card" onclick="usePrompt(this)">
              <div class="sc-icon">üî¨</div>
              <div class="sc-text">What are the latest breakthroughs in AI research?</div>
            </div>
            <div class="suggest-card" onclick="usePrompt(this)">
              <div class="sc-icon">üí°</div>
              <div class="sc-text">Explain quantum computing like I'm 10 years old</div>
            </div>
            <div class="suggest-card" onclick="usePrompt(this)">
              <div class="sc-icon">üíª</div>
              <div class="sc-text">Write a Python script to scrape data from a website</div>
            </div>
            <div class="suggest-card" onclick="usePrompt(this)">
              <div class="sc-icon">üåç</div>
              <div class="sc-text">What's happening in the world today?</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- INPUT -->
    <div class="input-area">
      <div class="input-wrap">
        <div class="quick-suggestions" id="quick-suggestions">
          <div class="qs-chip" onclick="useChip(this)">üåê Latest news</div>
          <div class="qs-chip" onclick="useChip(this)">üíª Write code</div>
          <div class="qs-chip" onclick="useChip(this)">üìä Analyze data</div>
          <div class="qs-chip" onclick="useChip(this)">üî¨ Research topic</div>
          <div class="qs-chip" onclick="useChip(this)">‚úçÔ∏è Write for me</div>
          <div class="qs-chip" onclick="useChip(this)">üßÆ Calculate</div>
        </div>
        <div class="input-box">
          <div class="input-row">
            <textarea id="msg-input" placeholder="Ask anything ‚Äî HK AI will search & reason for the best answer..." rows="1"
              onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
            <button class="send-btn" id="send-btn" onclick="sendMessage()">‚û§</button>
          </div>
          <div class="input-footer">
            <button class="input-tool" title="Attach file">üìé</button>
            <button class="input-tool" title="Voice input">üéô</button>
            <button class="input-tool" title="Image">üñº</button>
            <div class="input-hint">Shift+Enter for new line</div>
          </div>
        </div>
      </div>
    <!-- PHOTO PAGE -->
      <div class="page" id="page-photo">
        <div class="photo-layout">
          <div class="photo-tabs">
            <button class="ptab active" onclick="switchPTab(this,'pgen')">‚ú® Generate Image</button>
            <button class="ptab" onclick="switchPTab(this,'pedit')">üé® Edit Photo</button>
            <button class="ptab" onclick="switchPTab(this,'pgallery')">üñºÔ∏è My Gallery</button>
          </div>

          <!-- GENERATE TAB -->
          <div id="pgen">
            <div class="photo-gen-grid">
              <div class="pcard">
                <div class="pcard-title">‚ú® Image Generation</div>
                <div class="tf-group"><label class="tf-label">Describe your image</label>
                  <textarea class="tf-textarea" id="p-prompt" placeholder="e.g. A stunning sunset over African savanna with elephants silhouetted against orange sky, photorealistic, 8K..."></textarea>
                </div>
                <div class="tf-group"><label class="tf-label">Style</label>
                  <div class="style-grid">
                    <div class="style-opt active" onclick="selectStyle(this)"><span class="so-icon">üì∏</span>Realistic</div>
                    <div class="style-opt" onclick="selectStyle(this)"><span class="so-icon">üé®</span>Digital Art</div>
                    <div class="style-opt" onclick="selectStyle(this)"><span class="so-icon">üñåÔ∏è</span>Oil Painting</div>
                    <div class="style-opt" onclick="selectStyle(this)"><span class="so-icon">‚úèÔ∏è</span>Sketch</div>
                    <div class="style-opt" onclick="selectStyle(this)"><span class="so-icon">üå∏</span>Anime</div>
                    <div class="style-opt" onclick="selectStyle(this)"><span class="so-icon">üèõÔ∏è</span>3D Render</div>
                  </div>
                </div>
                <div class="tf-group"><label class="tf-label">Aspect Ratio</label>
                  <div class="aspect-btns">
                    <button class="aspect-btn active" onclick="selectAspect(this)">1:1</button>
                    <button class="aspect-btn" onclick="selectAspect(this)">16:9</button>
                    <button class="aspect-btn" onclick="selectAspect(this)">9:16</button>
                    <button class="aspect-btn" onclick="selectAspect(this)">4:3</button>
                    <button class="aspect-btn" onclick="selectAspect(this)">3:2</button>
                  </div>
                </div>
                <div class="tf-group"><label class="tf-label">Quality</label>
                  <select class="tf-select" id="p-quality">
                    <option>Standard (512x512)</option>
                    <option>HD (1024x1024)</option>
                    <option>Ultra HD (2048x2048)</option>
                    <option>4K (4096x4096)</option>
                  </select>
                </div>
                <div class="tf-group"><label class="tf-label">Negative Prompt (exclude)</label>
                  <input class="tf-input" id="p-negative" placeholder="e.g. blurry, watermark, text, low quality...">
                </div>
                <button class="gen-btn" id="pgen-btn" onclick="generatePhoto()">‚ú® Generate Image</button>
              </div>

              <div class="pcard">
                <div class="pcard-title">üëÅÔ∏è Preview</div>
                <div class="photo-preview" id="photo-preview">
                  <div style="font-size:36px">üñºÔ∏è</div>
                  <div style="font-size:12px;color:var(--muted)" id="pp-text">Your image will appear here</div>
                  <div class="vp-progress" id="pp-progress"><div class="vp-progress-fill" id="pp-progress-fill" style="width:0%"></div></div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">
                  <button class="gen-btn" style="padding:8px;font-size:11px" onclick="showToast('Image downloaded!','‚¨áÔ∏è')">‚¨áÔ∏è Save</button>
                  <button class="gen-btn" style="padding:8px;font-size:11px;background:linear-gradient(135deg,var(--a3),var(--a1))" onclick="switchPTab(document.querySelector('.ptab:nth-child(2)'),'pedit')">‚úèÔ∏è Edit</button>
                  <button class="gen-btn" style="padding:8px;font-size:11px;background:linear-gradient(135deg,var(--a2),var(--a4))" onclick="showToast('Shared!','üîó')">üîó Share</button>
                </div>
              </div>
            </div>

            <!-- Quick prompts -->
            <div class="pcard" style="margin-top:0">
              <div class="pcard-title">üí° Quick Inspiration</div>
              <div class="photo-grid">
                <div class="photo-item" onclick="usePhotoPrompt('A majestic lion at golden hour in African savanna, photorealistic, National Geographic style')">ü¶Å<div class="photo-item-label">Wildlife</div></div>
                <div class="photo-item" onclick="usePhotoPrompt('Futuristic city skyline at night with neon lights reflecting on wet streets, cyberpunk aesthetic')">üåÜ<div class="photo-item-label">Cityscape</div></div>
                <div class="photo-item" onclick="usePhotoPrompt('A beautiful African woman in traditional attire, studio portrait, vibrant colors, professional photography')">üë∏<div class="photo-item-label">Portrait</div></div>
                <div class="photo-item" onclick="usePhotoPrompt('Abstract colorful fluid art with swirling patterns, vivid colors, high detail digital art')">üé®<div class="photo-item-label">Abstract</div></div>
                <div class="photo-item" onclick="usePhotoPrompt('Delicious Kenyan food spread with nyama choma, ugali, sukuma wiki, professional food photography')">üçΩÔ∏è<div class="photo-item-label">Food</div></div>
                <div class="photo-item" onclick="usePhotoPrompt('Modern minimalist office interior design, clean lines, natural light, plants, aesthetic workspace')">üè¢<div class="photo-item-label">Interior</div></div>
                <div class="photo-item" onclick="usePhotoPrompt('Breathtaking Mount Kenya landscape at sunrise, misty valleys, dramatic sky, ultra wide angle')">üèîÔ∏è<div class="photo-item-label">Nature</div></div>
                <div class="photo-item" style="border-style:dashed;color:var(--muted)" onclick="document.getElementById('p-prompt').focus()">+<div class="photo-item-label">Custom</div></div>
              </div>
            </div>
          </div>

          <!-- EDIT TAB -->
          <div id="pedit" style="display:none">
            <div class="photo-gen-grid">
              <div class="pcard">
                <div class="pcard-title">üìÇ Upload Photo</div>
                <div class="edit-canvas" id="edit-canvas" onclick="triggerPhotoUpload()">
                  <div style="font-size:32px">üñºÔ∏è</div>
                  <div style="font-size:13px;color:var(--muted)">Click to upload photo</div>
                  <div style="font-size:11px;color:var(--muted2);margin-top:2px">JPG, PNG, WEBP up to 20MB</div>
                </div>
                <input type="file" id="photo-edit-input" accept="image/*" style="display:none" onchange="handlePhotoUpload(this)">

                <div class="tf-group">
                  <label class="tf-label">AI Instructions</label>
                  <textarea class="tf-textarea" id="p-edit-prompt" placeholder="Describe what you want to change... e.g. 'Remove background', 'Make it look cinematic', 'Change sky to sunset', 'Add dramatic lighting'"></textarea>
                </div>
                <button class="gen-btn" onclick="applyPhotoAI()">‚ú¶ Apply AI Edit</button>
              </div>

              <div class="pcard">
                <div class="pcard-title">üé® Adjustment Tools</div>
                <div class="photo-edit-tools">
                  <div class="pet-btn" onclick="applyPhotoEdit('bg-remove')"><span class="pet-icon">‚úÇÔ∏è</span><div class="pet-label">Remove BG</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('upscale')"><span class="pet-icon">üîç</span><div class="pet-label">Upscale</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('colorize')"><span class="pet-icon">üé®</span><div class="pet-label">Colorize</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('restore')"><span class="pet-icon">‚ú®</span><div class="pet-label">Restore</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('cartoon')"><span class="pet-icon">üñåÔ∏è</span><div class="pet-label">Cartoonify</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('face-enhance')"><span class="pet-icon">üòä</span><div class="pet-label">Face Fix</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('hdr')"><span class="pet-icon">‚ö°</span><div class="pet-label">HDR</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('noise')"><span class="pet-icon">üßπ</span><div class="pet-label">Denoise</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('crop')"><span class="pet-icon">üìê</span><div class="pet-label">Crop</div></div>
                  <div class="pet-btn" onclick="applyPhotoEdit('rotate')"><span class="pet-icon">üîÑ</span><div class="pet-label">Rotate</div></div>
                </div>

                <div class="tf-group"><label class="tf-label">Manual Adjustments</label></div>
                <div class="slider-row"><span class="slider-label">Brightness</span><input type="range" class="slider-input" min="0" max="100" value="50" oninput="this.nextElementSibling.textContent=this.value"><span class="slider-val">50</span></div>
                <div class="slider-row"><span class="slider-label">Contrast</span><input type="range" class="slider-input" min="0" max="100" value="50" oninput="this.nextElementSibling.textContent=this.value"><span class="slider-val">50</span></div>
                <div class="slider-row"><span class="slider-label">Saturation</span><input type="range" class="slider-input" min="0" max="100" value="50" oninput="this.nextElementSibling.textContent=this.value"><span class="slider-val">50</span></div>
                <div class="slider-row"><span class="slider-label">Sharpness</span><input type="range" class="slider-input" min="0" max="100" value="50" oninput="this.nextElementSibling.textContent=this.value"><span class="slider-val">50</span></div>
                <div class="slider-row"><span class="slider-label">Warmth</span><input type="range" class="slider-input" min="0" max="100" value="50" oninput="this.nextElementSibling.textContent=this.value"><span class="slider-val">50</span></div>

                <button class="gen-btn" style="margin-top:8px" onclick="showToast('Photo saved!','‚úÖ')">üíæ Save Edited Photo</button>
              </div>
            </div>
          </div>

          <!-- GALLERY TAB -->
          <div id="pgallery" style="display:none">
            <div class="pcard">
              <div class="pcard-title">üñºÔ∏è My Generated Images</div>
              <div class="photo-grid" style="grid-template-columns:repeat(5,1fr)">
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">üåÖ<div class="photo-item-label">Sunset Scene</div></div>
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">ü¶Å<div class="photo-item-label">Wildlife</div></div>
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">üåÜ<div class="photo-item-label">City Night</div></div>
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">üë∏<div class="photo-item-label">Portrait</div></div>
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">üèîÔ∏è<div class="photo-item-label">Mountain</div></div>
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">üé®<div class="photo-item-label">Abstract</div></div>
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">üçΩÔ∏è<div class="photo-item-label">Food Art</div></div>
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">üè¢<div class="photo-item-label">Interior</div></div>
                <div class="photo-item" onclick="showToast('Opening image...','üñºÔ∏è')">üå∏<div class="photo-item-label">Floral</div></div>
                <div class="photo-item" style="border-style:dashed;color:var(--muted)" onclick="switchPTab(document.querySelector('.ptab'),'pgen')">+<div class="photo-item-label">Generate</div></div>
              </div>
            </div>
          </div>

        </div>
      </div>

    <!-- VIDEO PAGE -->
      <div class="page" id="page-video">
        <div class="video-layout">
          <div class="video-tabs">
            <button class="vtab active" onclick="switchVTab(this,'vgen')">üé¨ Generate Video</button>
            <button class="vtab" onclick="switchVTab(this,'vedit')">‚úÇÔ∏è Edit Video</button>
            <button class="vtab" onclick="switchVTab(this,'vsamples')">üéûÔ∏è My Videos</button>
          </div>

          <!-- GENERATE TAB -->
          <div id="vgen">
            <div class="video-gen-grid">
              <div class="vcard">
                <div class="vcard-title">üé¨ Text to Video</div>
                <div class="tf-group"><label class="tf-label">Describe your video</label>
                  <textarea class="tf-textarea" id="v-prompt" placeholder="e.g. A cinematic shot of a futuristic city at night with neon lights and flying cars..."></textarea>
                </div>
                <div class="tf-group"><label class="tf-label">Style</label>
                  <select class="tf-select" id="v-style">
                    <option>Cinematic</option><option>Anime</option><option>Realistic</option>
                    <option>3D Animation</option><option>Documentary</option><option>Cartoon</option>
                  </select>
                </div>
                <div class="tf-group"><label class="tf-label">Duration</label>
                  <select class="tf-select" id="v-duration">
                    <option>5 seconds</option><option>10 seconds</option><option>15 seconds</option><option>30 seconds</option>
                  </select>
                </div>
                <div class="tf-group"><label class="tf-label">Resolution</label>
                  <select class="tf-select">
                    <option>720p HD</option><option>1080p Full HD</option><option>4K Ultra HD</option>
                  </select>
                </div>
                <button class="gen-btn" id="vgen-btn" onclick="generateVideo()">üé¨ Generate Video</button>
              </div>
              <div class="vcard">
                <div class="vcard-title">üëÅÔ∏è Preview</div>
                <div class="video-preview" id="video-preview">
                  <div class="vp-icon">üé¨</div>
                  <div class="vp-text" id="vp-text">Your video will appear here</div>
                  <div class="vp-progress" id="vp-progress"><div class="vp-progress-fill" id="vp-progress-fill" style="width:0%"></div></div>
                </div>
                <div style="display:flex;gap:8px">
                  <button class="gen-btn" style="flex:1;padding:8px" onclick="showToast('Video downloaded!','‚¨áÔ∏è')">‚¨áÔ∏è Download</button>
                  <button class="gen-btn" style="flex:1;padding:8px;background:linear-gradient(135deg,var(--a3),var(--a2))" onclick="showToast('Shared!','üîó')">üîó Share</button>
                </div>
              </div>
            </div>

            <div class="vcard" style="margin-top:0">
              <div class="vcard-title">üí° Quick Templates</div>
              <div class="video-samples">
                <div class="vsample" onclick="useVTemplate('A professional product showcase with smooth camera movement and clean background')">üì¶<div class="vsample-label">Product Showcase</div></div>
                <div class="vsample" onclick="useVTemplate('An inspiring motivational video with uplifting visuals and dynamic text animations')">üí™<div class="vsample-label">Motivational</div></div>
                <div class="vsample" onclick="useVTemplate('A nature documentary style video of a beautiful landscape with golden hour lighting')">üåÖ<div class="vsample-label">Nature</div></div>
                <div class="vsample" onclick="useVTemplate('A corporate explainer animation with clean minimal design and professional look')">üè¢<div class="vsample-label">Corporate</div></div>
                <div class="vsample" onclick="useVTemplate('A social media short video with trendy transitions and vibrant colors')">üì±<div class="vsample-label">Social Media</div></div>
                <div class="vsample" onclick="useVTemplate('A cinematic intro sequence with dramatic lighting and epic music visualization')">üé≠<div class="vsample-label">Cinematic Intro</div></div>
              </div>
            </div>
          </div>

          <!-- EDIT TAB -->
          <div id="vedit" style="display:none">
            <div class="vcard" style="margin-bottom:14px">
              <div class="vcard-title">üìÇ Upload Video to Edit</div>
              <div style="border:2px dashed var(--border);border-radius:10px;padding:32px;text-align:center;cursor:pointer;transition:all .2s" onclick="triggerVideoUpload()" onmouseover="this.style.borderColor='rgba(108,142,255,0.4)'" onmouseout="this.style.borderColor='var(--border)'">
                <div style="font-size:32px;margin-bottom:8px">üé•</div>
                <div style="font-size:13px;color:var(--muted)">Click to upload or drag & drop</div>
                <div style="font-size:11px;color:var(--muted2);margin-top:4px">MP4, MOV, AVI up to 500MB</div>
              </div>
              <input type="file" id="video-upload-input" accept="video/*" style="display:none" onchange="handleVideoUpload(this)">
            </div>
            <div class="vcard">
              <div class="vcard-title">‚úÇÔ∏è Editing Tools</div>
              <div class="edit-tools">
                <div class="edit-tool-btn" onclick="applyEdit('trim')"><div>‚úÇÔ∏è</div><div class="edit-tool-label">Trim</div></div>
                <div class="edit-tool-btn" onclick="applyEdit('subtitle')"><div>üí¨</div><div class="edit-tool-label">Subtitles</div></div>
                <div class="edit-tool-btn" onclick="applyEdit('filter')"><div>üé®</div><div class="edit-tool-label">Filters</div></div>
                <div class="edit-tool-btn" onclick="applyEdit('speed')"><div>‚ö°</div><div class="edit-tool-label">Speed</div></div>
                <div class="edit-tool-btn" onclick="applyEdit('music')"><div>üéµ</div><div class="edit-tool-label">Add Music</div></div>
                <div class="edit-tool-btn" onclick="applyEdit('text')"><div>‚úçÔ∏è</div><div class="edit-tool-label">Text Overlay</div></div>
                <div class="edit-tool-btn" onclick="applyEdit('crop')"><div>üìê</div><div class="edit-tool-label">Crop</div></div>
                <div class="edit-tool-btn" onclick="applyEdit('ai-enhance')"><div>‚ú¶</div><div class="edit-tool-label">AI Enhance</div></div>
              </div>
              <div class="tf-group"><label class="tf-label">AI Edit Instructions</label>
                <textarea class="tf-textarea" placeholder="Describe what you want to do with your video... e.g. 'Remove background noise, add subtitles, and make the colors more vibrant'"></textarea>
              </div>
              <button class="gen-btn" onclick="showToast('AI editing your video...','‚ú¶')">‚ú¶ Apply AI Edits</button>
            </div>
          </div>

          <!-- MY VIDEOS TAB -->
          <div id="vsamples" style="display:none">
            <div class="vcard">
              <div class="vcard-title">üéûÔ∏è My Generated Videos</div>
              <div class="video-samples" style="grid-template-columns:repeat(4,1fr)">
                <div class="vsample" onclick="showToast('Playing video...','‚ñ∂Ô∏è')">üåÜ<div class="vsample-label">City at Night</div></div>
                <div class="vsample" onclick="showToast('Playing video...','‚ñ∂Ô∏è')">üöÄ<div class="vsample-label">Space Journey</div></div>
                <div class="vsample" onclick="showToast('Playing video...','‚ñ∂Ô∏è')">üåä<div class="vsample-label">Ocean Waves</div></div>
                <div class="vsample" style="border-style:dashed;font-size:28px;color:var(--muted)" onclick="showPage('video')">+<div class="vsample-label">Generate New</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ===== STATE =====
let sources = {web: true, claude: true, deep: false};
let currentModel = 'HK AI Pro';
let isLoading = false;
let msgHistory = [];

// ===== SIDEBAR =====
function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  sb.classList.toggle('collapsed');
  document.querySelector('.sb-toggle').textContent = sb.classList.contains('collapsed') ? '‚ñ∂' : '‚óÄ';
}

// ===== MODEL =====
function toggleModelDropdown() {
  document.getElementById('model-dropdown').classList.toggle('open');
}
function setModel(name, el) {
  currentModel = name;
  document.getElementById('model-name').textContent = name;
  document.querySelectorAll('.model-opt').forEach(o => o.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('model-dropdown').classList.remove('open');
  showToast(`Switched to ${name}`, '‚ú¶');
  event.stopPropagation();
}
document.addEventListener('click', e => {
  if (!e.target.closest('#model-selector')) document.getElementById('model-dropdown').classList.remove('open');
});

// ===== SOURCES =====
function toggleSource(src) {
  sources[src] = !sources[src];
  const pill = document.getElementById('pill-' + src);
  pill.classList.toggle('off', !sources[src]);
}

// ===== CHAT =====
function hideWelcome() {
  const w = document.getElementById('welcome-screen');
  if (w) { w.style.display = 'none'; }
  document.getElementById('quick-suggestions').style.display = 'none';
}

function usePrompt(el) {
  document.getElementById('msg-input').value = el.querySelector('.sc-text').textContent;
  sendMessage();
}
function useChip(el) {
  const map = {
    'üåê Latest news': 'What is the latest news happening around the world today?',
    'üíª Write code': 'Write me a useful code snippet. What language and task would you suggest?',
    'üìä Analyze data': 'Help me understand how to analyze data effectively.',
    'üî¨ Research topic': 'Research a fascinating topic and give me a detailed summary.',
    '‚úçÔ∏è Write for me': 'Write a compelling piece of content. What topic should I give you?',
    'üßÆ Calculate': 'Help me with a calculation or math problem.'
  };
  document.getElementById('msg-input').value = map[el.textContent.trim()] || el.textContent;
  document.getElementById('msg-input').focus();
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
}
function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 140) + 'px';
}

async function sendMessage() {
  const input = document.getElementById('msg-input');
  const text = input.value.trim();
  if (!text || isLoading) return;

  isLoading = true;
  document.getElementById('send-btn').disabled = true;
  hideWelcome();

  // Add user message
  appendUserMsg(text);
  input.value = '';
  input.style.height = 'auto';
  msgHistory.push({ role: 'user', content: text });

  // Add to sidebar history
  addToHistory(text);

  // Show search indicator if web is on
  let searchEl = null;
  if (sources.web) {
    searchEl = showSearchIndicator();
  }

  // Show typing
  const typingId = showTyping();

  try {
    // Build system prompt
    const systemPrompt = `You are HK AI, a powerful general-purpose AI assistant that combines web search results, deep reasoning, and knowledge from multiple AI sources to give the most accurate, up-to-date, and comprehensive answers possible.

Your traits:
- You synthesize information from multiple sources to give the best answer
- You are direct, clear, and thorough
- You use markdown formatting: **bold**, bullet points, numbered lists, code blocks when appropriate  
- You cite when using recent/web information
- You acknowledge uncertainty when you don't know something
- You are helpful for ANY topic: technology, science, news, coding, writing, math, creative tasks, research

Current active sources: ${Object.entries(sources).filter(([,v])=>v).map(([k])=>k).join(', ')}
Model: ${currentModel}

Always give the best, most complete answer you can. If the question is about current events or recent information, note that and provide the most recent info you have.`;

    const response = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        messages: msgHistory,
        useWebSearch: sources.web
      })
    });

    const data = await response.json();
    let fullText = data.text || data.error || 'No response received.';
    if (!response.ok) fullText = `‚ö†Ô∏è Error: ${data.error || 'Something went wrong.'}`;

    removeElement(typingId);
    if (searchEl) removeElement(searchEl);

    msgHistory.push({ role: 'assistant', content: fullText || 'No response received.' });
    appendAIMsg(fullText || 'No response received.');

  } catch (err) {
    removeElement(typingId);
    if (searchEl) removeElement(searchEl);
    appendAIMsg(`‚ö†Ô∏è **Connection error.** Could not reach HK AI servers. Please check your connection and try again.\n\n_Error: ${err.message}_`);
  }

  isLoading = false;
  document.getElementById('send-btn').disabled = false;
}

function appendUserMsg(text) {
  const inner = document.getElementById('chat-inner');
  const div = document.createElement('div');
  div.className = 'msg user';
  div.innerHTML = `
    <div class="msg-av user">H</div>
    <div class="msg-content">
      <div class="msg-bubble user">${escHtml(text)}</div>
    </div>`;
  inner.appendChild(div);
  scrollToBottom();
}

function appendAIMsg(text) {
  const inner = document.getElementById('chat-inner');
  const div = document.createElement('div');
  div.className = 'msg';

  const activeSources = Object.entries(sources).filter(([,v])=>v).map(([k])=>k);
  const srcTagsHtml = activeSources.map(s => {
    const map = {web:['üåê','web','Web Search'],claude:['‚ú¶','claude','Claude AI'],deep:['üî¨','deep','Deep Research']};
    const [icon, cls, label] = map[s] || ['‚Ä¢','claude',s];
    return `<span class="src-tag ${cls}">${icon} ${label}</span>`;
  }).join('');

  div.innerHTML = `
    <div class="msg-av ai">‚ú¶</div>
    <div class="msg-content">
      <div class="source-tags">${srcTagsHtml}</div>
      <div class="msg-bubble ai">${formatMsg(text)}</div>
      <div class="msg-actions">
        <button class="act-btn" onclick="copyMsg(this)">üìã Copy</button>
        <button class="act-btn" onclick="regenMsg()">‚Ü∫ Retry</button>
      </div>
    </div>`;
  document.getElementById('chat-inner').appendChild(div);
  scrollToBottom();
}

function showTyping() {
  const id = 'typing-' + Date.now();
  const inner = document.getElementById('chat-inner');
  const div = document.createElement('div');
  div.className = 'msg';
  div.id = id;
  div.innerHTML = `
    <div class="msg-av ai">‚ú¶</div>
    <div class="msg-content">
      <div class="typing-bubble">
        <div class="typing-dots"><span></span><span></span><span></span></div>
        <div class="typing-label">HK AI is thinking...</div>
      </div>
    </div>`;
  inner.appendChild(div);
  scrollToBottom();
  return id;
}

function showSearchIndicator() {
  const id = 'search-' + Date.now();
  const inner = document.getElementById('chat-inner');
  const div = document.createElement('div');
  div.id = id;
  div.innerHTML = `
    <div class="search-indicator">
      <div class="search-spin"></div>
      Searching the web for latest information...
    </div>`;
  inner.appendChild(div);
  scrollToBottom();
  return id;
}

function removeElement(id) {
  const el = document.getElementById(id);
  if (el) el.remove();
}

function scrollToBottom() {
  const wrap = document.getElementById('chat-wrap');
  wrap.scrollTop = wrap.scrollHeight;
}

function formatMsg(text) {
  return text
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
    .replace(/\*(.*?)\*/g,'<em>$1</em>')
    .replace(/`([^`]+)`/g,'<code>$1</code>')
    .replace(/```(\w*)\n([\s\S]*?)```/g,'<pre><code>$2</code></pre>')
    .replace(/^### (.*$)/gm,'<strong style="font-size:14px;color:var(--a1)">$1</strong>')
    .replace(/^## (.*$)/gm,'<strong style="font-size:15px">$1</strong>')
    .replace(/^# (.*$)/gm,'<strong style="font-size:16px">$1</strong>')
    .replace(/^\- (.*$)/gm,'<li>$1</li>')
    .replace(/^(\d+)\. (.*$)/gm,'<li>$2</li>')
    .replace(/(<li>.*<\/li>\n?)+/g, s => `<ul>${s}</ul>`)
    .replace(/\n/g,'<br>');
}

function escHtml(t) {
  return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
}

function copyMsg(btn) {
  const bubble = btn.closest('.msg-content').querySelector('.msg-bubble');
  navigator.clipboard.writeText(bubble.innerText).then(() => showToast('Copied!','‚úÖ'));
}

function regenMsg() {
  if (msgHistory.length >= 2) {
    msgHistory.pop();
    const lastUser = msgHistory[msgHistory.length - 1];
    if (lastUser && lastUser.role === 'user') {
      msgHistory.pop();
      document.querySelectorAll('.msg').forEach((m, i, all) => {
        if (i >= all.length - 2) m.remove();
      });
      document.getElementById('msg-input').value = lastUser.content;
      sendMessage();
    }
  }
}

function newChat() {
  msgHistory = [];
  document.getElementById('chat-inner').innerHTML = '';
  // Re-add welcome
  const welcome = document.createElement('div');
  welcome.className = 'welcome';
  welcome.id = 'welcome-screen';
  welcome.innerHTML = `
    <div class="welcome-icon">‚ú¶</div>
    <h1>Ask me anything.</h1>
    <p>HK AI searches the web, reasons with advanced AI, and synthesizes the best answer from multiple sources ‚Äî all in real time.</p>
    <div class="source-badges">
      <div class="src-badge"><div class="dot" style="background:var(--a3)"></div>Web Search</div>
      <div class="src-badge"><div class="dot" style="background:var(--a1)"></div>Claude AI</div>
      <div class="src-badge"><div class="dot" style="background:var(--a2)"></div>Deep Reasoning</div>
      <div class="src-badge"><div class="dot" style="background:var(--a4)"></div>Multi-source</div>
    </div>
    <div class="suggest-grid">
      <div class="suggest-card" onclick="usePrompt(this)"><div class="sc-icon">üî¨</div><div class="sc-text">What are the latest breakthroughs in AI research?</div></div>
      <div class="suggest-card" onclick="usePrompt(this)"><div class="sc-icon">üí°</div><div class="sc-text">Explain quantum computing like I'm 10 years old</div></div>
      <div class="suggest-card" onclick="usePrompt(this)"><div class="sc-icon">üíª</div><div class="sc-text">Write a Python script to scrape data from a website</div></div>
      <div class="suggest-card" onclick="usePrompt(this)"><div class="sc-icon">üåç</div><div class="sc-text">What's happening in the world today?</div></div>
    </div>`;
  document.getElementById('chat-inner').appendChild(welcome);
  document.getElementById('quick-suggestions').style.display = 'flex';
  addToHistory('New Chat');
}

function addToHistory(text) {
  const list = document.getElementById('chat-list');
  document.querySelectorAll('.chat-item').forEach(i => i.classList.remove('active'));
  const item = document.createElement('div');
  item.className = 'chat-item active';
  item.innerHTML = `<div class="ci-title">${text.substring(0,40)}${text.length>40?'‚Ä¶':''}</div><div class="ci-time">just now</div>`;
  list.insertBefore(item, list.firstChild);
}

// ===== TRIAL SYSTEM =====
const TRIAL_DAYS = 7;
const MAX_UPLOADS = 10;

function initTrial() {
  // Set trial start if not set
  if (!localStorage.getItem('hkai_trial_start')) {
    localStorage.setItem('hkai_trial_start', Date.now().toString());
    localStorage.setItem('hkai_uploads', '0');
  }

  updateTrialBanner();
  updateUploadCounter();
  setInterval(updateTrialBanner, 60000); // update every minute
}

function updateTrialBanner() {
  const start = parseInt(localStorage.getItem('hkai_trial_start') || Date.now());
  const elapsed = Date.now() - start;
  const daysLeft = Math.max(0, TRIAL_DAYS - Math.floor(elapsed / (1000 * 60 * 60 * 24)));
  const hoursLeft = Math.max(0, Math.floor((TRIAL_DAYS * 24) - elapsed / (1000 * 60 * 60)));
  const minsLeft = Math.max(0, Math.floor(((TRIAL_DAYS * 24 * 60) - elapsed / (1000 * 60)) % 60));

  document.getElementById('trial-days').textContent = daysLeft;

  const countdownEl = document.getElementById('trial-countdown');
  if (daysLeft > 0) {
    countdownEl.textContent = `${daysLeft}d ${hoursLeft % 24}h ${minsLeft}m left`;
  } else {
    countdownEl.textContent = 'Trial expired!';
    showUpgrade();
  }

  // Show banner
  document.getElementById('trial-banner').classList.add('show');
  // Push content down
  document.querySelector('.app').style.marginTop = '36px';
}

function updateUploadCounter() {
  const used = parseInt(localStorage.getItem('hkai_uploads') || '0');
  const remaining = MAX_UPLOADS - used;
  const pct = (remaining / MAX_UPLOADS) * 100;

  const counter = document.getElementById('upload-counter');
  const countEl = document.getElementById('upload-count');
  const fillEl = document.getElementById('uc-fill');

  if (countEl) countEl.textContent = remaining;
  if (fillEl) fillEl.style.width = pct + '%';

  if (counter) {
    counter.classList.remove('warning', 'danger');
    if (remaining <= 3 && remaining > 0) counter.classList.add('warning');
    if (remaining <= 0) {
      counter.classList.add('danger');
      if (countEl) countEl.textContent = '0';
    }
  }
}

function useUpload() {
  const used = parseInt(localStorage.getItem('hkai_uploads') || '0');
  if (used >= MAX_UPLOADS) {
    showUpgrade();
    return false;
  }
  localStorage.setItem('hkai_uploads', (used + 1).toString());
  updateUploadCounter();
  return true;
}

// ===== UPGRADE MODAL =====
function showUpgrade() {
  document.getElementById('upgrade-overlay').classList.add('show');
}
function closeUpgrade() {
  document.getElementById('upgrade-overlay').classList.remove('show');
}
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeUpgrade(); });

// ===== PHOTO PAGE =====
function switchPTab(el, tabId) {
  document.querySelectorAll('.ptab').forEach(t => t.classList.remove('active'));
  if (el) el.classList.add('active');
  ['pgen','pedit','pgallery'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = id === tabId ? 'block' : 'none';
  });
}

function selectStyle(el) {
  document.querySelectorAll('.style-opt').forEach(s => s.classList.remove('active'));
  el.classList.add('active');
}

function selectAspect(el) {
  document.querySelectorAll('.aspect-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function generatePhoto() {
  const prompt = document.getElementById('p-prompt').value.trim();
  if (!prompt) { showToast('Please describe your image first', '‚ö†Ô∏è'); return; }

  if (!useUpload()) return;

  const btn = document.getElementById('pgen-btn');
  const preview = document.getElementById('photo-preview');
  const ppText = document.getElementById('pp-text');
  const ppProgress = document.getElementById('pp-progress');
  const ppFill = document.getElementById('pp-progress-fill');

  btn.disabled = true;
  btn.textContent = '‚è≥ Generating...';
  preview.classList.add('generating');
  ppProgress.classList.add('show');
  ppText.textContent = 'AI is creating your image...';

  const stages = ['üß† Analyzing prompt...','üé® Generating colors...','‚úèÔ∏è Rendering details...','‚ú® Adding finishing touches...'];
  let progress = 0;
  let stageIdx = 0;

  const interval = setInterval(() => {
    progress += Math.random() * 15;
    if (progress > 95) progress = 95;
    ppFill.style.width = progress + '%';
    stageIdx = Math.min(Math.floor(progress / 25), stages.length - 1);
    ppText.textContent = stages[stageIdx];
  }, 350);

  // Use Claude API to describe what the image would look like
  setTimeout(async () => {
    clearInterval(interval);
    ppFill.style.width = '100%';
    preview.classList.remove('generating');

    const style = document.querySelector('.style-opt.active')?.textContent?.trim() || 'Realistic';
    const quality = document.getElementById('p-quality').value;

    // Generate image description via Claude
    try {
      const resp = await fetch('/api/chat', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
          messages: [{role:'user', content:`Describe in vivid detail what this AI-generated image looks like: "${prompt}" in ${style} style. Write 2-3 sentences describing the visual result as if it was successfully generated. Be specific about colors, composition, and mood.`}],
          useWebSearch: false
        })
      });
      const data = await resp.json();
      const desc = data.text || 'Image generated successfully!';

      preview.innerHTML = `
        <div style="width:100%;height:100%;background:linear-gradient(135deg,rgba(108,142,255,0.15),rgba(167,139,250,0.15),rgba(52,211,153,0.1));border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;text-align:center;gap:10px">
          <div style="font-size:40px">üñºÔ∏è</div>
          <div style="font-size:11px;color:var(--a3);font-weight:600">‚úÖ Image Generated ‚Äî ${style} ‚Ä¢ ${quality}</div>
          <div style="font-size:11px;color:var(--muted);line-height:1.6;max-width:90%">${desc}</div>
          <div style="padding:4px 12px;background:rgba(108,142,255,0.1);border:1px solid rgba(108,142,255,0.2);border-radius:20px;font-size:10px;color:var(--a1)">Click Save to download</div>
        </div>`;
    } catch(e) {
      preview.innerHTML = `<div style="font-size:36px">üñºÔ∏è</div><div style="font-size:12px;color:var(--a3)">‚úÖ Image Ready!</div>`;
    }

    btn.disabled = false;
    btn.innerHTML = '‚ú® Generate Image';
    showToast('Image generated!', 'üñºÔ∏è');
    updateUploadCounter();
  }, 4000);
}

function usePhotoPrompt(prompt) {
  document.getElementById('p-prompt').value = prompt;
  showToast('Prompt loaded! Click Generate ‚ú®', 'üí°');
}

function triggerPhotoUpload() {
  if (!useUpload()) return;
  document.getElementById('photo-edit-input').click();
}

function handlePhotoUpload(input) {
  if (input.files && input.files[0]) {
    const file = input.files[0];
    const reader = new FileReader();
    reader.onload = (e) => {
      const canvas = document.getElementById('edit-canvas');
      canvas.innerHTML = `<img src="${e.target.result}" style="width:100%;height:100%;object-fit:contain;border-radius:10px">`;
      canvas.classList.add('has-image');
      canvas.onclick = null;
      showToast(`Photo "${file.name}" loaded!`, 'üì∏');
      updateUploadCounter();
    };
    reader.readAsDataURL(file);
  }
}

function applyPhotoEdit(tool) {
  const msgs = {
    'bg-remove': 'Removing background...','upscale': 'Upscaling image to 4x...','colorize': 'Colorizing photo...',
    'restore': 'Restoring and enhancing...','cartoon': 'Converting to cartoon style...','face-enhance': 'Enhancing facial features...',
    'hdr': 'Applying HDR effect...','noise': 'Removing noise...','crop': 'Cropping image...','rotate': 'Rotating image...'
  };
  showToast(msgs[tool] || 'Processing...', 'üé®');
}

function applyPhotoAI() {
  const prompt = document.getElementById('p-edit-prompt').value.trim();
  if (!prompt) { showToast('Please describe your edit first', '‚ö†Ô∏è'); return; }
  showToast('AI is editing your photo...', '‚ú¶');
  setTimeout(() => showToast('Edit applied successfully!', '‚úÖ'), 2000);
}

// Override showPage for photo
const _origShowPage = showPage;

// ===== VIDEO PAGE =====
function switchVTab(el, tabId) {
  document.querySelectorAll('.vtab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  ['vgen','vedit','vsamples'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = id === tabId ? 'block' : 'none';
  });
}

function generateVideo() {
  const prompt = document.getElementById('v-prompt').value.trim();
  if (!prompt) { showToast('Please describe your video first', '‚ö†Ô∏è'); return; }

  // Check upload/trial limits
  if (!useUpload()) return;

  const btn = document.getElementById('vgen-btn');
  const preview = document.getElementById('video-preview');
  const vpText = document.getElementById('vp-text');
  const vpProgress = document.getElementById('vp-progress');
  const vpFill = document.getElementById('vp-progress-fill');

  btn.disabled = true;
  btn.textContent = '‚è≥ Generating...';
  preview.classList.add('generating');
  vpProgress.classList.add('show');
  vpText.textContent = 'AI is generating your video...';

  // Simulate progress
  let progress = 0;
  const interval = setInterval(() => {
    progress += Math.random() * 12;
    if (progress > 95) progress = 95;
    vpFill.style.width = progress + '%';

    if (progress < 30) vpText.textContent = 'üß† Understanding your prompt...';
    else if (progress < 60) vpText.textContent = 'üé® Generating frames...';
    else if (progress < 85) vpText.textContent = 'üé¨ Compositing video...';
    else vpText.textContent = '‚ú® Finishing touches...';
  }, 400);

  setTimeout(() => {
    clearInterval(interval);
    vpFill.style.width = '100%';
    preview.classList.remove('generating');

    setTimeout(() => {
      vpProgress.classList.remove('show');
      preview.innerHTML = `
        <div style="font-size:40px">üé¨</div>
        <div style="font-size:12px;color:var(--a3);font-weight:600">‚úÖ Video Ready!</div>
        <div style="font-size:11px;color:var(--muted);max-width:200px;text-align:center;margin-top:4px">${prompt.substring(0,60)}${prompt.length>60?'...':''}</div>
        <div style="margin-top:8px;padding:4px 12px;background:rgba(108,142,255,0.1);border:1px solid rgba(108,142,255,0.2);border-radius:20px;font-size:10px;color:var(--a1)">‚ñ∂ Preview Available</div>`;
      btn.disabled = false;
      btn.innerHTML = 'üé¨ Generate Video';
      showToast('Video generated successfully!', 'üé¨');
      updateUploadCounter();
    }, 500);
  }, 5000);
}

function useVTemplate(prompt) {
  document.getElementById('v-prompt').value = prompt;
  showToast('Template loaded!', '‚ú¶');
}

function triggerVideoUpload() {
  if (!useUpload()) return;
  document.getElementById('video-upload-input').click();
}

function handleVideoUpload(input) {
  if (input.files && input.files[0]) {
    showToast(`Video "${input.files[0].name}" uploaded!`, 'üé•');
    updateUploadCounter();
  }
}

function applyEdit(tool) {
  const labels = {
    trim: 'Trimming video...', subtitle: 'Adding subtitles...', filter: 'Applying filters...',
    speed: 'Adjusting speed...', music: 'Adding music...', text: 'Adding text overlay...',
    crop: 'Cropping video...', 'ai-enhance': 'AI enhancing video...'
  };
  showToast(labels[tool] || 'Processing...', '‚úÇÔ∏è');
}

// Override file input tool to track uploads
document.addEventListener('DOMContentLoaded', () => {
  initTrial();

  // Intercept file attach button
  const attachBtn = document.querySelector('.input-tool[title="Attach file"]');
  if (attachBtn) {
    attachBtn.onclick = () => {
      if (!useUpload()) return;
      showToast('File attached (1 upload used)', 'üìé');
    };
  }
});

// ===== TOAST =====
let toastTimer;
function showToast(msg, icon = '‚úÖ') {
  const t = document.getElementById('toast');
  t.className = 'toast show';
  t.innerHTML = `<span>${icon}</span>${msg}`;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
}
</script>

<!-- TRIAL BANNER -->
<div class="trial-banner" id="trial-banner">
  <span>‚ö° Free Trial ‚Äî <span id="trial-days">7</span> days remaining</span>
  <div class="countdown" id="trial-countdown">Loading...</div>
  <div class="upgrade-link" onclick="showUpgrade()">Upgrade Now ‚Üí</div>
</div>

<!-- UPGRADE MODAL -->
<div class="upgrade-overlay" id="upgrade-overlay">
  <div class="upgrade-modal">
    <div class="um-icon">üöÄ</div>
    <h2>Upgrade HK AI</h2>
    <p>You've reached your free plan limit. Upgrade to continue with unlimited chats, more uploads, video generation, and priority AI responses.</p>
    <div class="plans-grid">
      <div class="plan-card">
        <div class="plan-name">Pro</div>
        <div class="plan-price">$9<span>/mo</span></div>
        <ul class="plan-features">
          <li>Unlimited chats</li>
          <li>50 file uploads/mo</li>
          <li>Web search</li>
          <li>Video generation</li>
          <li>Priority support</li>
        </ul>
      </div>
      <div class="plan-card popular">
        <div class="plan-badge">‚≠ê Most Popular</div>
        <div class="plan-name">Enterprise</div>
        <div class="plan-price">$29<span>/mo</span></div>
        <ul class="plan-features">
          <li>Everything in Pro</li>
          <li>Unlimited uploads</li>
          <li>Custom AI training</li>
          <li>API access</li>
          <li>Dedicated support</li>
        </ul>
      </div>
    </div>
    <button class="gen-btn" onclick="showToast('Redirecting to payment...','üí≥');closeUpgrade()">üí≥ Get Started</button>
    <button class="upgrade-close" onclick="closeUpgrade()">Maybe later</button>
  </div>
</div>
</body>
</html>
